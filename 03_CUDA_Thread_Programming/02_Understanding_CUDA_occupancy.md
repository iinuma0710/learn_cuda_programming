# 2.2 Understanding CUDA occupancy
CUDA の占有率 (Occupancy) は，各 SM が並行処理可能なワープの最大数のうち，アクティブな CUDA ワープの割合を表す．
一般的に，動作していないワープの遅延を隠蔽するのに，より多くのワープが利用可能となるため，
占有率を高めることで GPU を効率良く活用することができる．
しかし，CUDA スレッド間の計算資源の奪い合いが増えるため，パフォーマンスが落ちることもあり得る．
したがって，このトレードオフを理解しておくことが重要ある．

最適な CUDA の占有率を探索することで，GPU の計算資源を使って GPU アプリケーションがワープ命令を効率的に
発行できるようになる．
GPU は SM 上の複数のワープスケジューラを用いて，いくつものワープのスケジューリングをしている．
複数のワープが効率的にスケジューリングできれば，GPU のスレッド間やメモリレイテンシによる遅延を隠蔽することができる．
すると，CUDA コアは継続的に複数のワープから発行された命令を実行できるようになる．
一方で，スケジューリングされなかったワープは次の命令が発行できるようになるまで待機する必要がある．

CUDA の占有率は2つの方法で決定することができる．

- Teoritical occupancy  
  CUDA Occupancy Calculator によって決定される．
  CUDA Toolkit と Excel シートで提供されている．
  カーネルの計算資源の使用状況と，GPU の SM から理論的に各カーネルの占有率を計算できる．

- Achieved occupancy  
  GPU によって決定される．
  SM 上で実際に実行されたワープ数と，使用可能なワープの最大数を反映している．
  この占有率はメトリック解析を使った NVIDIA プロファイラによって計測される．

Theoritical occupancy は，命令間の依存関係やメモリ帯域の制限を考慮していないため，占有率の上限であると言える．

それでは，この占有率と CUDA C/C++ の関係について見ていこう．


## 3.2.1 Setting NVCC to report GPU resource usage
はじめに，次のような **Simple Matrix Multiplication (SEGMM)** カーネルを使う．

```c

```

このカーネル関数を，次のようなカーネルを使って呼び出す．